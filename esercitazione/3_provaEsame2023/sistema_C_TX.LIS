00000000                                     1  ***************   SISTEMA C -- Trasmettitore ******************
00000000                                     2  ***********************************************
00000000                                     3  ************ AREA DATI **********************
00008000                                     4  	ORG	$8000
00008000  01                                 5  INDK		DC.B		1	; Conta iterazioni
00008001  00                                 6  INDN		DC.B		0	; Conta caratteri inviati
00008002  =00000003                          7  K		EQU		3
00008002  =00000003                          8  N		EQU		3
00008002  =00002007                          9  PIACB		EQU		$2007
00008002  =00002006                         10  PIADB		EQU 		$2006
00008002                                    11  
00008002                                    12  *************************************************
00008002                                    13  * 	AREA MAIN
00008002                                    14  *************************************************
00008100                                    15  	ORG	$8100
00008100  4EB9 00008128                     16  MAIN		JSR	DVBOUT
00008106                                    17  		
00008106  40C0                              18  		MOVE.W	SR,D0
00008108  0240 D8FF                         19  		ANDI.W	#$D8FF,D0	;<- passo a stato utente e abilito interruzioni
0000810C  46C0                              20  		MOVE.W	D0,SR
0000810E                                    21  
0000810E  207C 00002006                     22  		MOVEA.L	#PIADB,A0
00008114  1010                              23  		MOVE.B	(A0),D0		;Lettura fittizia
00008116  10BC 0000                         24  		MOVE.B	#0,(A0)	; Messaggio qualunque, composto da tutti 0 in questo caso
0000811A                                    25  		
0000811A  43F9 00008001                     26  		LEA		INDN,A1
00008120  5251                              27  		ADD.W		#1,(A1)
00008122                                    28  
00008122                                    29  *************************************************************************
00008122  4EF9 00008122                     30  LOOP	JMP	LOOP
00008128                                    31  **************************************************************************
00008128                                    32  **************************************************
00008128                                    33  *	Subroutine per inizializzare PIA
00008128                                    34  **************************************************
00008128  11FC 0000 2007                    35  DVBOUT	MOVE.B	#0,PIACB
0000812E  11FC 00FF 2006                    36  		MOVE.B	#$FF,PIADB
00008134  11FC 0025 2007                    37  		MOVE.B	#%00100101,PIACB
0000813A  4E75                              38  		RTS
0000813C                                    39  **************************************************
0000813C                                    40  *	Interruzione che invia prossimo carattere
0000813C                                    41  **************************************************
00008600                                    42  	ORG	$8600
00008600  2F08                              43  INT1	MOVE.L	A0,-(A7)
00008602  2F09                              44  	MOVE.L	A1,-(A7)
00008604  2F0A                              45  	MOVE.L	A2,-(A7)
00008606  2F00                              46  	MOVE.L	D0,-(A7)
00008608                                    47  
00008608                                    48  
00008608  207C 00002006                     49  	MOVEA.L	#PIADB,A0
0000860E  227C 00008000                     50  	MOVEA.L	#INDK,A1
00008614  247C 00008001                     51  	MOVEA.L	#INDN,A2
0000861A                                    52  
0000861A  1010                              53  	MOVE.B	(A0),D0		;Lettura fittizia
0000861C                                    54  
0000861C  0C12 0003                         55  	CMP.B		#N,(A2)		;Confronto Caratteri inviati. Se non sono 3 ->prossimo carattere, senno vado a vedere se devo fare un altra iterazione
00008620  6600 0010                         56  	BNE	NXT
00008624                                    57  	
00008624  0C11 0003                         58  	CMP.B		#K,(A1)		;Se sto alla terza iterazione ho finito, altrimenti aggiungo 1 all iterazione e mando carattere (azzerando indx caratteri)
00008628  6700 000E                         59  	BEQ	EOM		
0000862C  14BC 0000                         60  	MOVE.B	#0,(A2)		
00008630  5211                              61  	ADD.B		#1,(A1)
00008632                                    62  
00008632  10BC 0000                         63  NXT	MOVE.B	#0,(A0)		;Scrivo su dato PIA B prossimo carattere
00008636  5252                              64  	ADD.W		#1,(A2)
00008638                                    65  
00008638                                    66  
00008638  201F                              67  EOM	MOVE.L	(A7)+,D0
0000863A  245F                              68  	MOVE.L	(A7)+,A2
0000863C  225F                              69  	MOVE.L	(A7)+,A1
0000863E  205F                              70  	MOVE.L	(A7)+,A0
00008640                                    71  	
00008640  4E73                              72  	RTE
00008642                                    73  
00008642                                    74  **************************************************
00008642                                    75  	END	MAIN

No errors detected
No warnings generated
