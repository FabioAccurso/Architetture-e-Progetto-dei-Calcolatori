00000000                                     1  ***************   SISTEMA B -- Trasmettitore ******************
00000000                                     2  ***********************************************
00000000                                     3  ************ AREA DATI **********************
00008000                                     4  	ORG	$8000
00008000  01                                 5  INDK		DC.B		1	; Conta iterazioni
00008001  00                                 6  INDN		DC.B		0	; Conta caratteri inviati
00008002  01                                 7  INDI		DC.B		1	;Messaggio di B (1 per il primo 2 per il secondo. Parto da 1)
00008003  =00000003                          8  K		EQU		3
00008003  =00000003                          9  N		EQU		3
00008003  =00002007                         10  PIACB		EQU		$2007
00008003  =00002006                         11  PIADB		EQU 		$2006
00008003                                    12  
00008003                                    13  *************************************************
00008003                                    14  * 	AREA MAIN
00008003                                    15  *************************************************
00008100                                    16  	ORG	$8100
00008100  4EB9 00008128                     17  MAIN		JSR	DVBOUT
00008106                                    18  		
00008106  40C0                              19  		MOVE.W	SR,D0
00008108  0240 D8FF                         20  		ANDI.W	#$D8FF,D0	;<- passo a stato utente e abilito interruzioni
0000810C  46C0                              21  		MOVE.W	D0,SR
0000810E                                    22  
0000810E  207C 00002006                     23  		MOVEA.L	#PIADB,A0
00008114  1010                              24  		MOVE.B	(A0),D0		;Lettura fittizia
00008116  10BC 00FF                         25  		MOVE.B	#$FF,(A0)	; Messaggio qualunque, composto da tutti 1 in questo caso
0000811A                                    26  		
0000811A  43F9 00008001                     27  		LEA		INDN,A1
00008120  5251                              28  		ADD.W		#1,(A1)
00008122                                    29  
00008122                                    30  *************************************************************************
00008122  4EF9 00008122                     31  LOOP	JMP	LOOP
00008128                                    32  **************************************************************************
00008128                                    33  **************************************************
00008128                                    34  *	Subroutine per inizializzare PIA
00008128                                    35  **************************************************
00008128  11FC 0000 2007                    36  DVBOUT	MOVE.B	#0,PIACB
0000812E  11FC 00FF 2006                    37  		MOVE.B	#$FF,PIADB
00008134  11FC 0025 2007                    38  		MOVE.B	#%00100101,PIACB
0000813A  4E75                              39  		RTS
0000813C                                    40  **************************************************
0000813C                                    41  *	Interruzione che invia prossimo carattere
0000813C                                    42  **************************************************
00008600                                    43  	ORG	$8600
00008600  2F08                              44  INT1	MOVE.L	A0,-(A7)
00008602  2F09                              45  	MOVE.L	A1,-(A7)
00008604  2F0A                              46  	MOVE.L	A2,-(A7)
00008606  2F00                              47  	MOVE.L	D0,-(A7)
00008608                                    48  
00008608                                    49  
00008608  207C 00002006                     50  	MOVEA.L	#PIADB,A0
0000860E  227C 00008000                     51  	MOVEA.L	#INDK,A1
00008614  247C 00008001                     52  	MOVEA.L	#INDN,A2
0000861A  267C 00008002                     53  	MOVEA.L	#INDI,A3
00008620                                    54  
00008620  1010                              55  	MOVE.B	(A0),D0		;Lettura fittizia
00008622                                    56  
00008622  0C12 0003                         57  	CMP.B		#N,(A2)		;Confronto Caratteri inviati. Se non sono 3 ->prossimo carattere, senno vado a vedere se devo fare un altra iterazione
00008626  6600 0028                         58  	BNE	NXT
0000862A                                    59  
0000862A  0C13 0002                         60  	CMP.B		#2,(A3)	
0000862E  6700 000E                         61  	BEQ		ICIT
00008632  5213                              62  	ADD.B		#1,(A3)
00008634  14BC 0000                         63  	MOVE.B	#0,(A2)
00008638  4EF9 00008650                     64  	JMP	NXT
0000863E                                    65  
0000863E                                    66  
0000863E  0C11 0003                         67  ICIT	CMP.B		#K,(A1)		;Se sto alla terza iterazione ho finito, altrimenti aggiungo 1 all iterazione e mando carattere (azzerando indx caratteri)
00008642  6700 0012                         68  	BEQ	EOM		
00008646  14BC 0000                         69  	MOVE.B	#0,(A2)	
0000864A  16BC 0001                         70  	MOVE.B	#1,(A3)	
0000864E  5211                              71  	ADD.B		#1,(A1)
00008650                                    72  
00008650  10BC 00FF                         73  NXT	MOVE.B	#$FF,(A0)	;Scrivo su dato PIA B prossimo carattere
00008654  5252                              74  	ADD.W		#1,(A2)
00008656                                    75  
00008656                                    76  
00008656  201F                              77  EOM	MOVE.L	(A7)+,D0
00008658  245F                              78  	MOVE.L	(A7)+,A2
0000865A  225F                              79  	MOVE.L	(A7)+,A1
0000865C  205F                              80  	MOVE.L	(A7)+,A0
0000865E                                    81  	
0000865E  4E73                              82  	RTE
00008660                                    83  
00008660                                    84  **************************************************
00008660                                    85  	END	MAIN

No errors detected
No warnings generated
